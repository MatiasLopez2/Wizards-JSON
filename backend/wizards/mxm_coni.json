{
  "name": "mxm_coni",
  "description": "Este wizard permite sacar un turno para el trámite de apto médico estudiantes",
  "initialStep": "A",
  "isActive": true,
  "steps": [
    {
      "name": "init",
      "description": "Paso de inicialización",
      "components": [
        {
          "order": 5,
          "name": "loader",
          "componentType": "SPINNER",
          "component": {
            "className": "text-purple-800/100",
            "size": 50,
            "strokeWidth": 2
          },
          "className": "flex items-center justify-center"
        }
      ],
      "events": {
        "ON_MOUNTED": [
          {
            "type": "CONDITIONAL",
            "order": 5,
            "conditions": true,
            "actions": [
              {
                "type": "SET_LOCAL_CONTEXT",
                "order": 5,
                "context": {
                  "key": "step1",
                  "type": "REMOTE_ACTION",
                  "actionName": "AltaTurnoViaXROAD",
                  "contexts": [
                    {
                      "key": "tramite",
                      "type": "VALUE",
                      "value": "Apto médico estudiantes"
                    },
                    {
                      "key": "paso",
                      "type": "VALUE",
                      "value": 1
                    },
                    {
                      "key": "cuil",
                      "type": "EXTERNAL_METADATA",
                      "expression": "cuil"
                    },
                    {
                      "key": "nombres",
                      "type": "EXTERNAL_METADATA",
                      "expression": "nombres"
                    },
                    {
                      "key": "apellidos",
                      "type": "EXTERNAL_METADATA",
                      "expression": "apellidos"
                    },
                    {
                      "key": "sexo",
                      "type": "EXTERNAL_METADATA",
                      "expression": "sexo"
                    },
                    {
                      "key": "fechaNacimiento",
                      "type": "EXTERNAL_METADATA",
                      "expression": "fechaNacimiento"
                    },
                    {
                      "key": "departamento",
                      "type": "EXTERNAL_METADATA",
                      "expression": "departamento"
                    },
                    {
                      "key": "correo",
                      "type": "EXTERNAL_METADATA",
                      "expression": "correo"
                    },
                    {
                      "key": "telefono",
                      "type": "EXTERNAL_METADATA",
                      "expression": "telefono"
                    }
                  ]
                },
                "contextName": "step1"
              }
            ]
          },
          {
            "type": "CONDITIONAL",
            "order": 10,
            "conditions": {
              "and": [
                {
                  "not": {
                    "isEmpty": {
                      "context": {
                        "key": "options",
                        "type": "LOCAL",
                        "expression": "data.campos.columnas[idCampo='Oficinas'].valores.{'value':id,'label':desc}"
                      }
                    }
                  }
                },
                {
                  "not": {
                    "isEmpty": {
                      "context": {
                        "key": "options",
                        "type": "LOCAL",
                        "expression": "data.campos.columnas[idCampo='Preferencias'].valores.{'value':id,'label':desc}"
                      }
                    }
                  }
                }
              ]
            },
            "then": [
              {
                "type": "CONDITIONAL",
                "order": 10,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 5,
                    "context": {
                      "key": "step2",
                      "type": "REMOTE_ACTION",
                      "actionName": "AltaTurnoViaXROAD",
                      "contexts": [
                        {
                          "key": "tramite",
                          "type": "VALUE",
                          "value": "Apto médico estudiantes"
                        },
                        {
                          "key": "paso",
                          "type": "VALUE",
                          "value": 2
                        },
                        {
                          "key": "cuil",
                          "type": "EXTERNAL_METADATA",
                          "expression": "cuil"
                        },
                        {
                          "key": "nombres",
                          "type": "EXTERNAL_METADATA",
                          "expression": "nombres"
                        },
                        {
                          "key": "apellidos",
                          "type": "EXTERNAL_METADATA",
                          "expression": "apellidos"
                        },
                        {
                          "key": "sexo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "sexo"
                        },
                        {
                          "key": "fechaNacimiento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "fechaNacimiento"
                        },
                        {
                          "key": "departamento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "departamento"
                        },
                        {
                          "key": "correo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "correo"
                        },
                        {
                          "key": "telefono",
                          "type": "EXTERNAL_METADATA",
                          "expression": "telefono"
                        },
                        {
                          "key": "oficinas",
                          "type": "VALUE",
                          "value": "50"
                        },
                        {
                          "key": "preferencias",
                          "type": "VALUE",
                          "value": "1"
                        }
                      ]
                    },
                    "contextName": "step2"
                  },
                  {
                    "type": "GO_TO_STEP",
                    "order": 10,
                    "stepName": {
                      "key": "paso",
                      "type": "VALUE",
                      "value": "A"
                    }
                  }
                ]
              }
            ],
            "else": [
              {
                "type": "CONDITIONAL",
                "order": 1,
                "conditions": {
                  "equals": {}
                },
                "then": [
                  {
                    "type": "CONDITIONAL",
                    "order": 1,
                    "conditions": true,
                    "actions": [
                      {
                        "type": "GO_TO_STEP",
                        "order": 1,
                        "stepName": {
                          "key": "paso",
                          "type": "VALUE",
                          "value": "unknown-error"
                        }
                      }
                    ]
                  }
                ],
                "else": [
                  {
                    "type": "CONDITIONAL",
                    "order": 1,
                    "conditions": true,
                    "actions": [
                      {
                        "type": "GO_TO_STEP",
                        "order": 1,
                        "stepName": {
                          "key": "paso",
                          "type": "VALUE",
                          "value": "error"
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      }
    },
    {
      "name": "A",
      "description": "Se obtiene el día y hora del turno",
      "className": "grid grid-cols-2 gap-2",
      "components": [
        {
          "order": 5,
          "name": "titulo-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Paso 1 de 2",
            "variantName": "mxm-title"
          },
          "className": "col-span-2"
        },
        {
          "order": 10,
          "name": "subtitulo-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Seleccioná tu turno",
            "variantName": "mxm-subtitle"
          },
          "className": "col-span-2"
        },
        {
          "order": 15,
          "name": "descripcion-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Turno para: Apto Médico Estudiantes<br>Centro de Medicina Preventiva Dr. Emilio Coni. Av. Godoy Cruz 187, Ciudad, Mendoza."
          },
          "className": "col-span-2"
        },
        {
          "order": 20,
          "name": "fecha",
          "componentType": "FIELD",
          "component": {
            "type": "DATE",
            "placeholder": "Elegí la fecha",
            "save": false
          },
          "className": "col-span-1",
          "events": {
            "ON_CHANGE": [
              {
                "type": "CONDITIONAL",
                "order": 5,
                "conditions": true,
                "actions": [
                  {
                    "type": "CLEAR_ERRORS",
                    "order": 1,
                    "fieldName": "fecha"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 10,
                "conditions": {
                  "not": {
                    "isEmpty": {
                      "context": {
                        "key": "fecha",
                        "type": "CURRENT_STEP_VALUES",
                        "fieldName": "fecha"
                      }
                    }
                  }
                },
                "then": [
                  {
                    "type": "CONDITIONAL",
                    "order": 5,
                    "conditions": true,
                    "actions": [
                      {
                        "type": "UPDATE_COMPONENT",
                        "order": 1,
                        "targetName": "hora",
                        "targetProp": "options",
                        "context": {
                          "key": "options",
                          "type": "LOCAL",
                          "expression": "[data.campos.columnas[idCampo='turnos'].valorCalendario[fecha='{{fecha}}'].horario.{'label':Hora,'value':Id}]",
                          "contexts": [
                            {
                              "key": "fecha",
                              "type": "CURRENT_STEP_VALUES",
                              "expression": "$fromMillis($toMillis($),'[Y0001]-[M01]-[D01]')",
                              "fieldName": "fecha"
                            }
                          ]
                        }
                      },
                      {
                        "type": "UPDATE_COMPONENT",
                        "order": 2,
                        "targetName": "hora",
                        "targetProp": "disabled",
                        "context": {
                          "key": "disabled",
                          "type": "VALUE",
                          "value": false
                        }
                      },
                      {
                        "type": "SET_VALUE",
                        "order": 3,
                        "targetName": "hora",
                        "context": {
                          "key": "hora",
                          "type": "VALUE",
                          "value": null
                        }
                      }
                    ]
                  }
                ],
                "else": [
                  {
                    "type": "CONDITIONAL",
                    "order": 5,
                    "conditions": true,
                    "actions": [
                      {
                        "type": "SET_VALUE",
                        "order": 1,
                        "targetName": "hora",
                        "context": {
                          "key": "hora",
                          "type": "VALUE",
                          "value": null
                        }
                      },
                      {
                        "type": "UPDATE_COMPONENT",
                        "order": 5,
                        "targetName": "hora",
                        "targetProp": "disabled",
                        "context": {
                          "key": "disabled",
                          "type": "VALUE",
                          "value": true
                        }
                      }
                    ]
                  }
                ]
              }
            ]
          },
          "top": {
            "components": [
              {
                "order": 5,
                "name": "labelFecha",
                "componentType": "LABEL",
                "component": {
                  "value": "Fecha de turno",
                  "variantName": "mxm-label"
                }
              }
            ]
          }
        },
        {
          "order": 25,
          "name": "hora",
          "componentType": "FIELD",
          "component": {
            "type": "SELECT",
            "save": false,
            "placeholder": "Elegí la hora",
            "options": []
          },
          "className": "col-span-1",
          "events": {
            "ON_CHANGE": [
              {
                "type": "CONDITIONAL",
                "order": 5,
                "conditions": true,
                "actions": [
                  {
                    "type": "CLEAR_ERRORS",
                    "order": 1,
                    "fieldName": "hora"
                  }
                ]
              }
            ]
          },
          "top": {
            "components": [
              {
                "order": 5,
                "name": "labelHora",
                "componentType": "LABEL",
                "component": {
                  "value": "Hora del turno",
                  "variantName": "mxm-label"
                }
              }
            ]
          }
        },
        {
          "order": 30,
          "name": "previous",
          "componentType": "BUTTON",
          "component": {
            "label": "Cancelar",
            "variantName": "mxm-previous-button"
          },
          "className": "mt-2 col-span-1 flex justify-start",
          "events": {
            "ON_CLICK": [
              {
                "type": "CONDITIONAL",
                "order": 1,
                "conditions": true,
                "actions": [
                  {
                    "type": "FINISH_WIZARD",
                    "order": 1
                  }
                ]
              }
            ]
          }
        },
        {
          "order": 35,
          "name": "next",
          "componentType": "BUTTON",
          "component": {
            "label": "Siguiente",
            "variantName": "mxm-next-button"
          },
          "className": "mt-2 col-span-1 flex justify-end",
          "events": {
            "ON_CLICK": [
              {
                "type": "CONDITIONAL",
                "order": 0,
                "conditions": true,
                "actions": [
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 1,
                    "targetName": "next",
                    "targetProp": "disabled",
                    "context": {
                      "key": "disabled",
                      "type": "VALUE",
                      "value": true
                    }
                  },
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 2,
                    "targetName": "next",
                    "targetProp": "loading",
                    "context": {
                      "key": "loading",
                      "type": "VALUE",
                      "value": true
                    }
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 1,
                "conditions": {
                  "isEmpty": {
                    "context": {
                      "key": "fecha",
                      "type": "CURRENT_STEP_VALUES",
                      "fieldName": "fecha"
                    }
                  }
                },
                "actions": [
                  {
                    "type": "ADD_ERROR",
                    "order": 1,
                    "fieldName": "fecha",
                    "errorMessage": "La fecha es requerida"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 2,
                "conditions": {
                  "isEmpty": {
                    "context": {
                      "key": "hora",
                      "type": "CURRENT_STEP_VALUES",
                      "fieldName": "hora"
                    }
                  }
                },
                "actions": [
                  {
                    "type": "ADD_ERROR",
                    "order": 1,
                    "fieldName": "hora",
                    "errorMessage": "La hora es requerida"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 3,
                "conditions": {
                  "and": [
                    {
                      "not": {
                        "isEmpty": {
                          "context": {
                            "key": "fecha",
                            "type": "CURRENT_STEP_VALUES",
                            "fieldName": "fecha"
                          }
                        }
                      }
                    },
                    {
                      "not": {
                        "isEmpty": {
                          "context": {
                            "key": "hora",
                            "type": "CURRENT_STEP_VALUES",
                            "fieldName": "hora"
                          }
                        }
                      }
                    }
                  ]
                },
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 2,
                    "context": {
                      "key": "step3",
                      "type": "REMOTE_ACTION",
                      "actionName": "AltaTurnoViaXROAD",
                      "contexts": [
                        {
                          "key": "tramite",
                          "type": "VALUE",
                          "value": "Apto médico estudiantes"
                        },
                        {
                          "key": "paso",
                          "type": "VALUE",
                          "value": 3
                        },
                        {
                          "key": "cuil",
                          "type": "EXTERNAL_METADATA",
                          "expression": "cuil"
                        },
                        {
                          "key": "nombres",
                          "type": "EXTERNAL_METADATA",
                          "expression": "nombres"
                        },
                        {
                          "key": "apellidos",
                          "type": "EXTERNAL_METADATA",
                          "expression": "apellidos"
                        },
                        {
                          "key": "sexo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "sexo"
                        },
                        {
                          "key": "fechaNacimiento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "fechaNacimiento"
                        },
                        {
                          "key": "departamento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "departamento"
                        },
                        {
                          "key": "correo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "correo"
                        },
                        {
                          "key": "telefono",
                          "type": "EXTERNAL_METADATA",
                          "expression": "telefono"
                        },
                        {
                          "key": "oficinas",
                          "type": "VALUE",
                          "value": "50"
                        },
                        {
                          "key": "preferencias",
                          "type": "VALUE",
                          "value": "1"
                        },
                        {
                          "key": "turnos",
                          "type": "CURRENT_STEP_VALUES",
                          "expression": "value",
                          "fieldName": "hora"
                        }
                      ]
                    },
                    "contextName": "step3"
                  },
                  {
                    "type": "GO_TO_STEP",
                    "order": 10,
                    "stepName": {
                      "key": "paso",
                      "type": "VALUE",
                      "value": "B"
                    }
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 99,
                "conditions": true,
                "actions": [
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 1,
                    "targetName": "next",
                    "targetProp": "disabled",
                    "context": {
                      "key": "disabled",
                      "type": "VALUE",
                      "value": false
                    }
                  },
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 2,
                    "targetName": "next",
                    "targetProp": "loading",
                    "context": {
                      "key": "loading",
                      "type": "VALUE",
                      "value": false
                    }
                  }
                ]
              }
            ]
          }
        }
      ],
      "events": {
        "ON_MOUNTED": [
          {
            "type": "CONDITIONAL",
            "order": 0,
            "conditions": {
              "equals": {}
            },
            "actions": [
              {
                "type": "INIT_STEP_VALUES",
                "order": 1
              }
            ]
          },
          {
            "type": "CONDITIONAL",
            "order": 10,
            "conditions": true,
            "actions": [
              {
                "type": "UPDATE_COMPONENT",
                "order": 2,
                "targetName": "fecha",
                "targetProp": "includeDates",
                "context": {
                  "key": "includeDates",
                  "type": "LOCAL",
                  "expression": "[data.campos.columnas[idCampo='turnos'].valorCalendario.fecha]"
                }
              }
            ]
          },
          {
            "type": "CONDITIONAL",
            "order": 15,
            "conditions": {
              "not": {
                "isEmpty": {
                  "context": {
                    "key": "fecha",
                    "type": "CURRENT_STEP_VALUES",
                    "fieldName": "fecha"
                  }
                }
              }
            },
            "actions": [
              {
                "type": "UPDATE_COMPONENT",
                "order": 1,
                "targetName": "hora",
                "targetProp": "options",
                "context": {
                  "key": "includeDates",
                  "type": "LOCAL",
                  "expression": "[data.campos.columnas[idCampo='turnos'].valorCalendario[fecha='{{fecha}}'].horario.{'label':Hora,'value':Id}]",
                  "contexts": [
                    {
                      "key": "fecha",
                      "type": "CURRENT_STEP_VALUES",
                      "expression": "$fromMillis($toMillis($),'[Y0001]-[M01]-[D01]')",
                      "fieldName": "fecha"
                    }
                  ]
                }
              }
            ]
          },
          {
            "type": "CONDITIONAL",
            "order": 20,
            "conditions": {
              "isEmpty": {
                "context": {
                  "key": "hora",
                  "type": "CURRENT_STEP_VALUES",
                  "fieldName": "hora"
                }
              }
            },
            "actions": [
              {
                "type": "UPDATE_COMPONENT",
                "order": 3,
                "targetName": "hora",
                "targetProp": "disabled",
                "context": {
                  "key": "disabled",
                  "type": "VALUE",
                  "value": true
                }
              }
            ]
          }
        ],
        "ON_WINDOW_BEFORE_UNLOAD": [
          {
            "type": "CONDITIONAL",
            "order": 5,
            "conditions": true,
            "actions": [
              {
                "type": "CONSOLE_LOG",
                "order": 0,
                "message": "Turno cancelado"
              },
              {
                "type": "CONFIRM_LEAVE_PAGE",
                "order": 5
              }
            ]
          }
        ]
      }
    },
    {
      "name": "B",
      "description": "Se confirma el turno",
      "className": "grid grid-cols-2 gap-2",
      "components": [
        {
          "order": 5,
          "name": "titulo-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Paso 2 de 2",
            "variantName": "mxm-title"
          },
          "className": "col-span-2"
        },
        {
          "order": 10,
          "name": "subtitulo-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Confirmá tu turno",
            "variantName": "mxm-subtitle"
          },
          "className": "col-span-2"
        },
        {
          "order": 15,
          "name": "descripcion-paso-1",
          "componentType": "TEXT",
          "component": {
            "value": "Tu turno fué asignado para el {{fecha}} a las {{hora}}",
            "contexts": [
              {
                "key": "fecha",
                "type": "LOCAL",
                "contextName": "step3",
                "expression": "data.idturnootorgado.Fecha"
              },
              {
                "key": "hora",
                "type": "LOCAL",
                "contextName": "step3",
                "expression": "data.idturnootorgado.Hora"
              }
            ],
            "className": "font-medium"
          },
          "className": "col-span-2"
        },
        {
          "order": 20,
          "name": "alert-tiempo",
          "componentType": "ALERT",
          "component": {
            "variantName": "mxm-alert",
            "value": "<span class=\"font-semibold\">Para asegurarlo, confirmá y realizá el pago.</span> Tenés 3 minutos para iniciar el proceso; pasado ese tiempo, el turno se anulará automáticamente."
          },
          "className": "col-span-2 mb-2"
        },
        {
          "order": 30,
          "name": "previous",
          "componentType": "BUTTON",
          "component": {
            "label": "Anular",
            "variantName": "mxm-previous-button"
          },
          "className": "col-span-1 flex justify-start",
          "events": {
            "ON_CLICK": [
              {
                "type": "CONDITIONAL",
                "order": 1,
                "conditions": true,
                "actions": [
                  {
                    "type": "KILL_TASK",
                    "order": 1,
                    "name": "FinalizarExpiración"
                  },
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 5,
                    "context": {
                      "key": "anulado",
                      "type": "REMOTE_ACTION",
                      "actionName": "AnularTurno",
                      "contexts": [
                        {
                          "key": "turnCode",
                          "type": "LOCAL",
                          "expression": "data.idturnootorgado.Id"
                        }
                      ]
                    },
                    "contextName": "anulado"
                  },
                  {
                    "type": "GO_TO_STEP",
                    "order": 10,
                    "stepName": {
                      "key": "paso",
                      "type": "VALUE",
                      "value": "init"
                    }
                  }
                ]
              }
            ]
          }
        },
        {
          "order": 35,
          "name": "next",
          "componentType": "BUTTON",
          "component": {
            "label": "Confirmar y pagar",
            "variantName": "mxm-next-button"
          },
          "className": "col-span-1 flex justify-end",
          "events": {
            "ON_CLICK": [
              {
                "type": "CONDITIONAL",
                "order": 0,
                "conditions": true,
                "actions": [
                  {
                    "type": "KILL_TASK",
                    "order": 5,
                    "name": "FinalizarExpiración"
                  },
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 10,
                    "targetName": "next",
                    "targetProp": "disabled",
                    "context": {
                      "key": "disabled",
                      "type": "VALUE",
                      "value": true
                    }
                  },
                  {
                    "type": "UPDATE_COMPONENT",
                    "order": 15,
                    "targetName": "next",
                    "targetProp": "loading",
                    "context": {
                      "key": "loading",
                      "type": "VALUE",
                      "value": true
                    }
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 5,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 1,
                    "context": {
                      "key": "step4",
                      "type": "REMOTE_ACTION",
                      "actionName": "AltaTurnoViaXROAD",
                      "contexts": [
                        {
                          "key": "tramite",
                          "type": "VALUE",
                          "value": "Apto médico estudiantes"
                        },
                        {
                          "key": "paso",
                          "type": "VALUE",
                          "value": 4
                        },
                        {
                          "key": "cuil",
                          "type": "EXTERNAL_METADATA",
                          "expression": "cuil"
                        },
                        {
                          "key": "nombres",
                          "type": "EXTERNAL_METADATA",
                          "expression": "nombres"
                        },
                        {
                          "key": "apellidos",
                          "type": "EXTERNAL_METADATA",
                          "expression": "apellidos"
                        },
                        {
                          "key": "sexo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "sexo"
                        },
                        {
                          "key": "fechaNacimiento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "fechaNacimiento"
                        },
                        {
                          "key": "departamento",
                          "type": "EXTERNAL_METADATA",
                          "expression": "departamento"
                        },
                        {
                          "key": "correo",
                          "type": "EXTERNAL_METADATA",
                          "expression": "correo"
                        },
                        {
                          "key": "telefono",
                          "type": "EXTERNAL_METADATA",
                          "expression": "telefono"
                        },
                        {
                          "key": "oficinas",
                          "type": "VALUE",
                          "value": "50"
                        },
                        {
                          "key": "preferencias",
                          "type": "VALUE",
                          "value": "1"
                        },
                        {
                          "key": "turnos",
                          "type": "LOCAL",
                          "expression": "data.idturnootorgado.Id"
                        }
                      ]
                    },
                    "contextName": "step4"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 10,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 1,
                    "context": {
                      "key": "resGenerarTurno",
                      "type": "REMOTE_ACTION",
                      "actionName": "GenerarTurno",
                      "contexts": [
                        {
                          "key": "cuil",
                          "type": "EXTERNAL_METADATA",
                          "expression": "$replace(cuil, '-', '')"
                        },
                        {
                          "key": "date",
                          "type": "LOCAL",
                          "expression": "data.idturnootorgado.Fecha"
                        },
                        {
                          "key": "hour",
                          "type": "LOCAL",
                          "expression": "data.idturnootorgado.Hora"
                        },
                        {
                          "key": "turnId",
                          "type": "LOCAL",
                          "expression": "data.idturnootorgado.Id"
                        }
                      ]
                    },
                    "contextName": "resGenerarTurno"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 15,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 1,
                    "context": {
                      "key": "resObtenerTurno",
                      "type": "REMOTE_ACTION",
                      "actionName": "ObtenerTurno",
                      "contexts": [
                        {
                          "key": "keycloakToken",
                          "type": "EXTERNAL_METADATA",
                          "expression": "keycloakToken"
                        }
                      ]
                    },
                    "contextName": "resObtenerTurno"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 20,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 1,
                    "context": {
                      "key": "resBuscarDeuda",
                      "type": "REMOTE_ACTION",
                      "actionName": "BuscarDeuda",
                      "contexts": [
                        {
                          "key": "keycloakToken",
                          "type": "EXTERNAL_METADATA",
                          "expression": "keycloakToken"
                        },
                        {
                          "key": "actionId",
                          "type": "LOCAL",
                          "expression": "$sort(data.turns[name='Apto médico estudiantes'], function($l, $r) {$l.id < $r.id})[0].id"
                        }
                      ]
                    },
                    "contextName": "resBuscarDeuda"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 25,
                "conditions": true,
                "actions": [
                  {
                    "type": "SET_LOCAL_CONTEXT",
                    "order": 1,
                    "context": {
                      "key": "resGenerarLink",
                      "type": "REMOTE_ACTION",
                      "actionName": "GenerarLink",
                      "contexts": [
                        {
                          "key": "keycloakToken",
                          "type": "EXTERNAL_METADATA",
                          "expression": "keycloakToken"
                        },
                        {
                          "key": "organismId",
                          "type": "LOCAL",
                          "expression": "data.organism_id"
                        },
                        {
                          "key": "actionId",
                          "type": "LOCAL",
                          "expression": "$sort(data.turns[name='Apto médico estudiantes'], function($l, $r) {$l.id < $r.id})[0].id"
                        },
                        {
                          "key": "officeName",
                          "type": "LOCAL",
                          "expression": "$sort(data.turns[name='Apto médico estudiantes'], function($l, $r) {$l.id < $r.id})[0].office"
                        },
                        {
                          "key": "rateId",
                          "type": "LOCAL",
                          "expression": "data.rate_id"
                        },
                        {
                          "key": "rateCode",
                          "type": "LOCAL",
                          "expression": "data.rate_code"
                        },
                        {
                          "key": "description",
                          "type": "VALUE",
                          "value": "Apto médico estudiantes"
                        },
                        {
                          "key": "quantity",
                          "type": "VALUE",
                          "value": 1
                        },
                        {
                          "key": "amount",
                          "type": "LOCAL",
                          "expression": "data.amount"
                        }
                      ]
                    },
                    "contextName": "resGenerarLink"
                  }
                ]
              },
              {
                "type": "CONDITIONAL",
                "order": 30,
                "conditions": true,
                "actions": [
                  {
                    "type": "EXECUTE_FORM",
                    "order": 1
                  }
                ]
              }
            ]
          }
        }
      ],
      "events": {
        "ON_MOUNTED": [
          {
            "type": "CONDITIONAL",
            "order": 5,
            "conditions": true,
            "actions": [
              {
                "type": "SCHEDULE_TASK",
                "order": 20,
                "name": "FinalizarExpiración"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "C",
      "description": "Paso 4. Turno Confirmado Exitosamente",
      "className": "grid grid-cols-1 gap-2",
      "components": [
        {
          "order": 5,
          "name": "cabecera-paso-3",
          "componentType": "TEXT",
          "component": {
            "value": "{{contenido}}",
            "contexts": [
              {
                "key": "contenido",
                "type": "LOCAL",
                "expression": "data.dscGeneral",
                "contextName": "step4"
              }
            ]
          },
          "className": "col-span-1"
        },
        {
          "order": 10,
          "name": "next",
          "componentType": "BUTTON",
          "component": {
            "label": "Ir a mis turnos",
            "variantName": "mxm-next-button"
          },
          "className": "col-span-1 flex justify-end",
          "events": {
            "ON_CLICK": [
              {
                "type": "CONDITIONAL",
                "order": 1,
                "conditions": true,
                "actions": [
                  {
                    "type": "REDIRECT",
                    "order": 1,
                    "contexts": [
                      {
                        "key": "url",
                        "type": "EXTERNAL_METADATA",
                        "expression": "url"
                      }
                    ]
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    {
      "name": "error",
      "description": "Muestra un error de que el turno no puede sacarse",
      "components": [
        {
          "order": 5,
          "name": "error-top",
          "componentType": "ALERT",
          "component": {
            "variantName": "error-alert",
            "value": "{{contenido}}",
            "contexts": [
              {
                "key": "contenido",
                "type": "LOCAL",
                "expression": "data.campos.errorMsg[0].textMsg",
                "contextName": "step1"
              },
              {
                "key": "status",
                "type": "LOCAL",
                "expression": "status",
                "contextName": "step1"
              }
            ]
          }
        }
      ]
    },
    {
      "name": "unknown-error",
      "description": "Muestra un error desconocido",
      "components": [
        {
          "order": 5,
          "name": "error-top",
          "componentType": "ALERT",
          "component": {
            "variantName": "error-alert",
            "value": "Servicio no disponible en este momento. Por favor, inténtelo más tarde."
          }
        }
      ]
    }
  ]
}